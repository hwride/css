<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Response images with srcset and sizes</title>
	<link rel="stylesheet" type="text/css" href="../common.css">
	<link rel="stylesheet" type="text/css" href="srcset-sizes.css">
</head>
<body>
<h1>Response images with srcset and sizes</h1>
<ul>
	<li><a href="#references">References</a></li>
	<li><a href="#general-notes">General notes</a></li>
	<li><a href="#questions">Questions</a></li>
	<li>
		<a href="#examples">Examples</a>
		<ul>
			<li><a href="#simple-img">Simple image with src</a></li>
			<li><a href="#srcset-pixel-density-descriptor">srcset with pixel density descriptors</a></li>
			<li><a href="#srcset-width-descriptors">srcset with width descriptors</a></li>
			<li><a href="#srcset-and-sizes">srcset and sizes</a></li>
		</ul>
	</li>
	<li><a href="#results">Results</a></li>
</ul>

<h2 id="references">References</h2>
<ul>
	<li>
		<a href="https://jakearchibald.com/2015/anatomy-of-responsive-images/">
			Jake Archibald - The anatomy of responsive images
		</a>
	</li>
	<li><a href="https://caniuse.com/srcset">caniuse - srcset and sizes</a></li>
	<li><a href="https://html.spec.whatwg.org/multipage/embedded-content.html#attr-img-srcset">HTML specification</a></li>
</ul>

<h2 id="general-notes">General notes</h2>
<p class="example-description">
	The zoom level can affect device pixel ratio. If you notice the device pixel ratio isn't what you expect check
	if you're zoomed in.
</p>

<h2 id="questions">Questions</h2>
<ul>
	<li>
		How does rounding work for device pixel ratio and width descriptors with srcset?
		Does it round up to ensure we never have an image too low resolution?
	</li>
	<li>
		Why are the images below different rendered widths when the same image is picked? I.e. sometimes the picked
		image is the 1500x250, but its rendered with is 500x250. This is when no width information is provided on HTML
		attributes or in the CSS, so why is it not the natural image size?
	</li>
</ul>

<h2 id="examples">Examples</h2>
<div id="simple-img" class="example">
	<h3>
		Simple image with <code>src</code> attribute
	</h3>
	<p class="example-description">
		This is just a standard image with a <code>src</code> attribute. It will load exactly the image specified in
		<code>src</code> and never any other.
	</p>
	<pre>
&lt;img alt="A test responsive image"
     src="fallback.png" /&gt;
		</pre>
	<img alt="A test responsive image"
			 src="fallback.png" />
</div>

<!-- Pixel density descriptor -->
<div id="srcset-pixel-density-descriptor" class="example">
	<h3>
		Image with <code>srcset</code> and display density descriptor.
	</h3>
	<p class="example-description">
		The pixel density descriptor of <code>srcset</code> lets you tell the browser what image should be used
		depending on the device pixel ratio. If there are 1x, 2x or 3x device pixels to CSS pixels then the corresponding
		image will be chosen.
	</p>
	<p class="example-description">
		You can see the device pixel ratio in the information in the bottom right of the screen under <code>devicePixelRatio</code>.
	</p>
	<p class="example-description">
		Note that the actual number width of the device or window does not affect the calculation, only the device pixel
		ratio.
	</p>
	<pre>
&lt;img alt="A test responsive image"
     src="fallback.png"
     srcset="500x250.png 1x,
             1000x250.png 2x,
             1500x250.png 3x" /&gt;
		</pre>
	<img
		alt="A test responsive image"
		src="fallback.png"
		srcset="
			500x250.png 1x,
			1000x250.png 2x,
			1500x250.png 3x
		" />
</div>

<!-- srcset with pixel widths-->
<div id="srcset-width-descriptors" class="example">
	<h3>
		Image with <code>srcset</code> and pixel widths.
	</h3>
	<p class="example-description">
		Here <code>srcset</code> is used to define at images at different sizes. The format is:
		<code>&lt;image-url&gt; &lt;width descriptor&gt;</code>. Width descriptor describes the pixel width of the source
		image.
	</p>

	<h3>Without sizes</h3>
	<p class="example-description">
		Some resources online say that when <code>srcset</code> is used without <code>sizes</code>, it is assumed the
		image should fill the entire browser width. But according to the specification it is invalid to use
		<code>srcset</code> with width descriptors without a <code>sizes</code> attribute:
	</p>
	<blockquote cite="https://html.spec.whatwg.org/multipage/embedded-content.html#attr-img-srcset">
		If the <code>srcset</code> attribute is present and has any image candidate strings using a width
		descriptor, the <code>sizes</code> attribute must also be present
	</blockquote>

	<h3>Pixel density</h3>
	<p class="example-description">
		Note that even when using width descriptors with <code>srcset</code>, the browser will try and take pixel density
		into account. It will do this by selecting an image size according to device pixels rather than CSS pixels. You
		can see this value in the info section as <code>devicePixelRatio * outerWidth</code>.
	</p>
	<pre>
&lt;img alt="A test responsive image"
     src="fallback.png"
     srcset="250x250.png 250w,
             500x250.png 500w,
             1000x250.png 1000w,
             1500x250.png 1500w" /&gt;
		</pre>
	<!-- src is a fallback for older browsers -->
	<!-- srcset: browser uses first condition that matches -->
	<!-- sizes: it appears the media queries match the document width and not the window width, at least on Chrome -->
	<img alt="A test responsive image"
			 src="fallback.png"
			 srcset="250x250.png 250w,
								 500x250.png 500w,
								 1000x250.png 1000w,
								 1500x250.png 1500w" />
</div>

<!-- srcset and sizes-->
<div id="srcset-and-sizes" class="example">
	<h3>
		Image with <code>srcset</code> and <code>sizes</code> attribute
	</h3>
	<p class="example-description">
		When using the <code>sizes</code> attributes you are able to specify conditions about when each image should be
		used yourself.
	</p>
	<p class="example-description">
		An important thing to note is the <code>sizes</code> media conditions use CSS pixels, but the actual image size
		chosen from <code>srcset</code> will continue to take pixel density into account.
	</p>
	<p class="example-description">
		The statements in <code>sizes</code> are read first to last, and the first matching one will one. This means order
		is important depending on how you write your media conditions.
	</p>
	<pre>
&lt;img alt="A test responsive image"
     src="fallback.png"
     srcset="250x250.png 250w,
             500x250.png 500w,
             1000x250.png 1000w,
             1500x250.png 1500w"
     sizes="(min-width: 1500px) 1500px,
            (min-width: 1000px) 1000px,
            (min-width: 500px) 500px,
            (min-width: 250px) 250px,
            100vw" /&gt;
		</pre>
	<!-- src is a fallback for older browsers -->
	<!-- srcset: browser uses first condition that matches -->
	<!-- sizes: it appears the media queries match the document width and not the window width, at least on Chrome -->
	<img alt="A test responsive image"
			 src="fallback.png"
			 srcset="250x250.png 250w,
								 500x250.png 500w,
								 1000x250.png 1000w,
								 1500x250.png 1500w"
			 sizes="(min-width: 1500px) 1500px,
								(min-width: 1000px) 1000px,
								(min-width: 500px) 500px,
								(min-width: 250px) 250px,
								100vw" />
</div>
<div class="info">
	<table>
		<tr>
			<td><code>window.devicePixelRatio</code></td><td><span class="device-pixel-ratio"></span></td>
		</tr>
		<tr>
			<td><code>window.outerWidth</code></td><td><span class="window-outer-width"></span></td>
		</tr>
		<tr>
			<td><code>devicePixelRatio * outerWidth</code></td><td><span class="device-pixels-outer"></span></td>
		</tr>
		<tr>
			<td><code>window.innerWidth</code></td><td><span class="window-inner-width"></span></td>
		</tr>
		<tr>
			<td><code>devicePixelRatio * innerWidth</code></td><td><span class="device-pixels-inner"></span></td>
		</tr>
	</table>
</div>

<!-- Results -->
<div id="results">
	<h2>
		Results
	</h2>
	<p class="example-description">
		Here is a recording of the images that were loaded for various device, browser and window sizes combinations
		for the examples above.
	</p>
	<table>
		<thead>
			<tr>
				<th>Device</th>
				<th>Device pixel ratio</th>
				<th>outerWidth</th>
				<th>innerWidth</th>
				<th>Device pixels - inner</th>
				<th>DPR image</th>
				<th>srcset only image</th>
				<th>srcset + sizes image</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>iPhone 11</td>
				<td>2</td>
				<td>414</td>
				<td></td>
				<td></td>
				<td>1000x250</td>
				<td>1000x250</td>
				<td>500x250</td>
			</tr>
			<tr>
				<td>mono e(7i) power + Chrome 97</td>
				<td>1.75</td>
				<td>412</td>
				<td>574 (higher?)</td>
				<td>1004.5</td>
				<td>1000x250</td>
				<td>1000x250</td>
				<td>1000x250</td>
			</tr>
			<tr>
				<th colspan="6">Windows 10 + Chrome 105</th>
			</tr>
			<tr>
				<td>Windows 10 + Chrome 105</td>
				<td>1</td>
				<td>516</td>
				<td></td>
				<td></td>
				<td>500x250</td>
				<td>500x250</td>
				<td>500x250</td>
			</tr>
			<tr>
				<td>Windows 10 + Chrome 105</td>
				<td>1</td>
				<td>520</td>
				<td></td>
				<td></td>
				<td>1000x250</td>
				<td>1000x250</td>
				<td>1000x250</td>
			</tr>
			<tr>
				<td>Windows 10 + Chrome 105</td>
				<td>1</td>
				<td>1000</td>
				<td></td>
				<td></td>
				<td>1000x250</td>
				<td>1000x250</td>
				<td>1000x250</td>
			</tr>
			<tr>
				<td>Windows 10 + Chrome 105</td>
				<td>1</td>
				<td>1017</td>
				<td></td>
				<td></td>
				<td>1500x250</td>
				<td>1500x250</td>
				<td>1500x250</td>
			</tr>
			<tr>
				<td>Windows 10 + Chrome 105</td>
				<td>1.25</td>
				<td>2048</td>
				<td></td>
				<td></td>
				<td>1500x250</td>
				<td>1500x250</td>
				<td>1500x250</td>
			</tr>

			<!-- Firefox -->
			<tr>
				<th colspan="6">Windows 10 + Firefox 104</th>
			</tr>
			<tr>
				<td>Windows 10 + Firefox 104</td>
				<td>1.2</td>
				<td>426</td>
				<td>416</td>
				<td>499.2</td>
				<td>1000x250</td>
				<td>500x250</td>
				<td>500x250</td>
			</tr>
			<tr>
				<td>Windows 10 + Firefox 104</td>
				<td>1.2</td>
				<td>427</td>
				<td>417</td>
				<td>500.4</td>
				<td>1000x250</td>
				<td>1000x250</td>
				<td>500x250</td>
			</tr>
			<tr>
				<td>Windows 10 + Firefox 104</td>
				<td>1.2</td>
				<td>509</td>
				<td>499</td>
				<td>611</td>
				<td>1000x250</td>
				<td>1000x250</td>
				<td>500x250</td>
			</tr>
			<tr>
				<td>Windows 10 + Firefox 104</td>
				<td>1.2</td>
				<td>510</td>
				<td>500</td>
				<td>612</td>
				<td>1000x250</td>
				<td>1000x250</td>
				<td>1000x250</td>
			</tr>
			<tr>
				<td>Windows 10 + Firefox 104</td>
				<td>1.2</td>
				<td>842</td>
				<td>833</td>
				<td>999.59</td>
				<td>1000x250</td>
				<td>1000x250</td>
				<td>1000x250</td>
			</tr>
			<tr>
				<td>Windows 10 + Firefox 104</td>
				<td>1.2</td>
				<td>844</td>
				<td>834</td>
				<td>1000.8</td>
				<td>1000x250</td>
				<td>1500x250</td>
				<td>1000x250</td>
			</tr>
			<tr>
				<td>Windows 10 + Firefox 104</td>
				<td>1.2</td>
				<td>1009</td>
				<td>999</td>
				<td>1199</td>
				<td>1000x250</td>
				<td>1500x250</td>
				<td>1000x250</td>
			</tr>
			<tr>
				<td>Windows 10 + Firefox 104</td>
				<td>1.2</td>
				<td>1010</td>
				<td>1000</td>
				<td>1212</td>
				<td>1000x250</td>
				<td>1500x250</td>
				<td>1500x250</td>
			</tr>
		</tbody>
	</table>
</div>
</body>
<script src="../nav.js"></script>
<script>createNav()</script>
<script src="srcset-sizes.js"></script>
</html>
